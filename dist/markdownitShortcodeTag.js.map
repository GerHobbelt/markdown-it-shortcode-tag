{"version":3,"file":"markdownItShortcodeTag.modern.js","sources":["../index.js"],"sourcesContent":["\n\nexport default function shortcode_plugin(md, shortcodes, options) {\n  options = options || {};\n  const interpolator = options.interpolator || function (expr, env) { return env[expr]; };\n  const defaultRuleIndex = md.block.ruler.__find__('html_block');\n  if (defaultRuleIndex < 0 || !shortcodes) return;\n\n  const tags = Object.getOwnPropertyNames(shortcodes);\n  const inlineTags = [];\n\n  if (tags.length < 1) return;\n  for (const tag of tags) {\n    if (typeof shortcodes[tag].render !== 'function') {\n      throw new Error('missing render function for shortcode tag: ' + tag);\n    }\n    if (shortcodes[tag].inline) inlineTags.push(tag);\n  }\n\n  const reName = '([a-zA-Z_:][a-zA-Z0-9:._-]*)';\n  const reNumber = '(-?(?:\\\\d*\\\\.\\\\d+|\\\\d+)(?:[eE]-?\\\\d+)?)';\n  const reString = '(\\'[^\\']*\\'|\"[^\"]*\")';\n  const reExpr = '(#\\\\{[^}]*\\\\})';\n\n  const reAttrs = new RegExp(\n    '\\\\s+' + reName +\n        '(?:\\\\s*=\\\\s*(?:' + reNumber + '|' + reString + '|' + reExpr + '))?',\n    'g'\n  );\n  const reStrExpr = new RegExp(reExpr);\n\n  const reTag = /^<(\\w+)/;\n\n  function testTag(content, tagList) {\n    const blockTag = reTag.exec(content);\n    return blockTag && tagList.find(tag => tag === blockTag[1]);\n  }\n\n  function rule(state) {\n    let tokens = state.tokens;\n\n    if (!state.md.options.html) return;\n\n    for (let i = tokens.length - 1; i >= 0; i--) {\n      const currentToken = tokens[i];\n\n      if (currentToken.type !== 'html_block') continue;\n\n      if (!testTag(currentToken.content, inlineTags)) continue;\n\n      let token, level = currentToken.level;\n      const nodes = [];\n\n      token = new state.Token('paragraph_open', 'p', 1);\n      token.level = level++;\n      nodes.push(token);\n\n      token = new state.Token('inline', '', 0);\n      token.content = currentToken.content;\n      token.level = level;\n      token.children = [];\n      nodes.push(token);\n\n      token = new state.Token('paragraph_close', 'p', -1);\n      token.level = --level;\n      nodes.push(token);\n\n      state.tokens = tokens = md.utils.arrayReplaceAt(tokens, i, nodes);\n    }\n  }\n\n  if (inlineTags.length > 0) md.core.ruler.after('block', 'shortcode', rule);\n\n  const fallback = function (tokens, idx, options, env, self) {\n    return self.renderToken(tokens, idx, options);\n  };\n\n  const defaultRender = {\n    html_block: md.renderer.rules.html_block || fallback,\n    html_inline: md.renderer.rules.html_inline || fallback\n  };\n\n  function render(tokens, idx, options, env, self) {\n    const content = tokens[idx].content;\n\n    let parameters = {}, attr;\n    while ((attr = reAttrs.exec(content))) {\n      if (attr[4]) { //interpolated\n        let expr = attr[4].slice(2, -1).trim();\n        parameters[attr[1]] = interpolator(expr, env);\n      } else if (attr[3]) { //quoted\n        const raw = attr[3].slice(1, -1);\n        parameters[attr[1]] = raw.replace(reStrExpr, (match) => {\n          const expr = match.slice(2, -1);\n          return env[expr];\n        });\n      } else if (attr[2]) { //number\n        parameters[attr[1]] = parseFloat(attr[2]);\n      } else {\n        parameters[attr[1]] = true;\n      }\n    }\n\n    const tag = testTag(content, tags);\n    if (tag)  {\n      return shortcodes[tag].render(parameters, env);\n    }\n\n    return defaultRender[tokens[idx].type](tokens, idx, options, env, self);\n  }\n\n  md.renderer.rules.html_block = md.renderer.rules.html_inline = render;\n}\n"],"names":["shortcode_plugin","md","shortcodes","options","interpolator","expr","env","defaultRuleIndex","block","ruler","__find__","tags","Object","getOwnPropertyNames","inlineTags","length","tag","render","Error","inline","push","reName","reNumber","reString","reExpr","reAttrs","RegExp","reStrExpr","reTag","testTag","content","tagList","blockTag","exec","find","rule","state","tokens","html","i","currentToken","type","token","level","nodes","Token","children","utils","arrayReplaceAt","core","after","fallback","idx","self","renderToken","defaultRender","html_block","renderer","rules","html_inline","parameters","attr","slice","trim","raw","replace","match","parseFloat"],"mappings":"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"}